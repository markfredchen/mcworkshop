<html>
<head>

<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<script type="text/javascript" src="/nfc/static/common/js/ace-extra.min.js"></script>
</head>
<body>
    <form action="http://localhost:8080/examples/upload/avatar" method="post" enctype="multipart/form-data" id="MyUploadForm">
        <input name="ImageFile" id="ImageFile" type="file" />
         <input type="button" id="submit-btn" onclick="uploadAvatar()" value="Upload" />
    </form>
    <img id="output" style="width: 300px; height: auto"></img>
    
    <wicket:container wicket:id="footer-scripts"></wicket:container>
    <script type="text/javascript">
    var files;
        
     // Add events
     $('input[type=file]').on('change', prepareUpload);
      
     // Grab the files and set them to our variable
     function prepareUpload(event){
       files = event.target.files;
     }
     
     
    function uploadAvatar(){
    	event.stopPropagation(); // Stop stuff happening
        event.preventDefault(); // Totally stop stuff happening
     
        // START A LOADING SPINNER HERE
     
        // Create a formdata object and add the files
        var data = new FormData();
        $.each(files, function(key, value)
        {
            data.append(key, value);
        });
    	$.ajax({
            url: 'http://localhost:8080/examples/upload/avatar',
            type: 'POST',
            data: data,
            cache: false,
            dataType: 'json',
            processData: false, // Don't process the files
            contentType: false, // Set content type to false as jQuery will tell the server its a query string request
            success: function(data, textStatus, jqXHR)
            {
            	$("img#output").attr("src", "http://localhost:8080/examples/get/avatar?filename=" + data[0].name);
            	$("img#output").Jcrop();
            	alert(111);
            },
            error: function(jqXHR, textStatus, errorThrown)
            {
                // Handle errors here
                console.log('ERRORS: ' + textStatus);
                // STOP LOADING SPINNER
            }
        });
    }
    (function() {
        var matched, browser;

        // Use of jQuery.browser is frowned upon.
        // More details: http://api.jquery.com/jQuery.browser
        // jQuery.uaMatch maintained for back-compat
        jQuery.uaMatch = function( ua ) {
            ua = ua.toLowerCase();

            var match = /(chrome)[ \/]([\w.]+)/.exec( ua ) ||
                /(webkit)[ \/]([\w.]+)/.exec( ua ) ||
                /(opera)(?:.*version|)[ \/]([\w.]+)/.exec( ua ) ||
                /(msie) ([\w.]+)/.exec( ua ) ||
                ua.indexOf("compatible") < 0 && /(mozilla)(?:.*? rv:([\w.]+)|)/.exec( ua ) ||
                [];

            return {
                browser: match[ 1 ] || "",
                version: match[ 2 ] || "0"
            };
        };

        matched = jQuery.uaMatch( navigator.userAgent );
        browser = {};

        if ( matched.browser ) {
            browser[ matched.browser ] = true;
            browser.version = matched.version;
        }

        // Chrome is Webkit, but Webkit is also Safari.
        if ( browser.chrome ) {
            browser.webkit = true;
        } else if ( browser.webkit ) {
            browser.safari = true;
        }

        jQuery.browser = browser;
    })();
				</script>
</body>
</html>